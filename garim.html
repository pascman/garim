<!doctype html>
<html lang="ko">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1.0, user-scalable=no">
    <title>가림치료</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
</head>
<body>
    <div class="container" style="padding: 16px;">
        <div class="input-group">
            <span class="input-group-text" style="width: 100px;">오른쪽</span><input id="right-hour" type="text" class="form-control form-control-lg" value="6" disabled><span class="input-group-text">시간</span>
        </div>
        <div class="input-group mt-3">
            <span class="input-group-text" style="width: 100px;">왼쪽</span><input id="left-hour" type="text" class="form-control form-control-lg" value="10" disabled><span class="input-group-text">시간</span>
        </div>
        <div class="input-group mt-3">
            <span class="input-group-text" style="width: 100px;">시작눈</span>
            <select class="form-select form-select-lg" id="start-eye">
                <option value="LEFT">왼쪽</option>
                <option value="RIGHT">오른쪽</option>
            </select>
        </div>
        <div class="input-group mt-3">
            <span class="input-group-text" style="width: 100px;">시작시간</span><input type="time" class="form-control form-control-lg" id="start-time">
        </div>
        <div class="input-group mt-3">
            <span class="input-group-text" style="width: 100px;">자는시간</span><input type="time" class="form-control form-control-lg" id="sleep-time">
        </div>
        <button class="btn btn-lg btn-primary mt-3" style="width: 100%;" onclick="doCalc()">계산</button>
        <button class="btn btn-lg btn-danger mt-3" style="width: 100%;" onclick="doReject()">초기화</button>

        <div id="alert" class="alert alert-info mt-3 d-none" role="alert">
        </div>
    </div>

    <script>
        function printTime(date,totalMinutes){
            const hours = String(Math.floor(totalMinutes / 60)).padStart(2, '0');
            const minutes = String(Math.floor(totalMinutes % 60)).padStart(2, '0');
            const shour = String(date.getHours()).padStart(2, '0')
            const sminute = String(date.getMinutes()).padStart(2, '0')

            if(hours > 0 ) {
                return `${shour}:${sminute} 시작 (가림 ${hours}시간 ${minutes}분 )`;
            }else{
                return `${shour}:${sminute} 시작 (가림  ${minutes}분)`;
            }
        }
        function doReject(){
            document.getElementById('start-time').value = ''
            document.getElementById('sleep-time').value = '' 
            document.getElementById('alert').classList.add('d-none');
            document.getElementById('alert').innerHTML  = ''
        }
        function doCalc() {
            const leftHour = parseInt(document.getElementById('left-hour').value);
            const rightHour = parseInt(document.getElementById('right-hour').value);
            const startEye = document.getElementById('start-eye').value;
            const startTime = document.getElementById('start-time').value;
            const sleepTime = document.getElementById('sleep-time').value;
            if(!startTime || !sleepTime) {
                alert('시작시간과 자는시간을 입력해주세요.');
                return;
            }
            const startDate = new Date(`1970-01-01T${startTime}:00`);
            const sleepDate = new Date(`1970-01-01T${sleepTime}:00`);
            let totalMilliseconds = sleepDate - startDate;
            if (totalMilliseconds < 0) {
                totalMilliseconds += 24 * 60 * 60 * 1000; // 24시간을 밀리초로 변환하여 더함
            }

            const totalMinutes = Math.floor(totalMilliseconds / (1000 * 60));
            const totalRatioParts = parseInt(leftHour) + parseInt(rightHour)
            const leftMinutesDecimal = (parseInt(leftHour) / totalRatioParts) * totalMinutes;
            const rightMinutesDecimal = (parseInt(rightHour) / totalRatioParts) * totalMinutes;     
            const leftMilliseconds = leftMinutesDecimal * 60 * 1000;
            const rightMilliseconds = rightMinutesDecimal * 60 * 1000;
            
            let prag = ''
            if(startEye == 'LEFT') {
                const cdate = new Date(startDate.getTime() + leftMilliseconds);
                prag = `왼쪽 눈은 ${printTime(startDate,leftMinutesDecimal)}<br>오른쪽 눈은 ${printTime(cdate,rightMinutesDecimal)}`;
            }else{
                const cdate = new Date(startDate.getTime() + rightMilliseconds);
                prag = `오른쪽 눈은 ${printTime(startDate,rightMinutesDecimal)}<br>왼쪽 눈은 ${printTime(cdate,leftMinutesDecimal)}`;
            }

            document.getElementById('alert').classList.remove('d-none');
            document.getElementById('alert').innerHTML = `
                <h4 class="alert-heading">가림치료 시간</h4>
                <p style="margin:0;">${prag}</p>`

        }
    </script>
</body>
</html>